function lum = rgb2lum( rgb )% RGB2LUM  Convert RGB values to luminance (cd/m^2)%% lum = rgb2lum( rgb )% 16-Apr-1998 -- created (RFM)% 06-Nov-2007 -- rewritten for native 32-bit greyscale mode (RFM)global ENVIRONp=ENVIRON.monitor.gamma;% check rgb rangergb = clipwarn(rgb,[ 0 255 ]);% clip to useful rangelow = (rgb<p(2));if any(low(:))    rgb(low) = p(2);end% convertlum = p(1)*((rgb-p(2))/(255-p(2))).^p(3) + p(4);return